{% extends 'base.html' %}
{% load static %}
{% load mathfilters %}

{% block head %}
    <link href="https://vjs.zencdn.net/7.17.0/video-js.css" rel="stylesheet" />
    <title>Video Quality Assessment</title>
    <script src="/static/js/jquery-3.6.0.js"></script>
    <script>
      let testednumber={{ testednumber }};

      function repaint_video(data){
        console.log(data);
        $('#current_videocaption').text(data.video_caption);
        $('#current_videoID').text(data.video_videoID);
        $('#my-video_html5_api').attr("src",data.video_url);
        $('#current_video').attr("src",data.video_url);
        $('#current_videocount').text("您当前评估了"+testednumber+"个视频");
        $('#current_videocount_p').text("您当前评估了"+testednumber+"个视频，还有"+(10-testednumber)+"个视频需要评估。");
      }

      $(function(){
        $('#btn_true').click(function(){
          let videoid = $('#current_videoID').text();
          $.get('/get_quality/?res=2&id='+videoid,function(data){
            if (data["status"]!='ok') console.log("can't recieve response");
            else {
              console.log('send data successfully');
              testednumber+=1;
              $.get('/get_next/?testednumber='+testednumber,function(data){
                if (data["status"]=="end"){
                  window.location.replace("{% url 'thankspage' %}");
                }
                repaint_video(data);
              });
            }
          })
        })
        $('#btn_uncertain').click(function(){
          let videoid = $('#current_videoID').text();
          $.get('/get_quality/?res=1&id='+videoid,function(data){
            if (data["status"]!='ok') console.log("can't recieve response");
            else {
              console.log('send data successfully');
              testednumber+=1;
              $.get('/get_next/?testednumber='+testednumber,function(data){
                if (data["status"]=="end"){
                  window.location.replace("{% url 'thankspage' %}");
                }
                repaint_video(data);
              });
            }
          })
        })
        $('#btn_fake').click(function(){
          let videoid = $('#current_videoID').text();
          $.get('/get_quality/?res=0&id='+videoid,function(data){
            if (data["status"]!='ok') console.log("can't recieve response");
            else {
              console.log('send data successfully');
              testednumber+=1;
              $.get('/get_next/?testednumber='+testednumber,function(data){
                if (data["status"]=="end"){
                  window.location.replace("{% url 'thankspage' %}");
                }
                repaint_video(data);
              });
            }
          })
        })
      })

    </script>
{% endblock %}

{% block content %}

<div class="container" style="margin-top: 1.5em;">
  <div class="row">
    <div class="col-sm-3">
      
      <div class="card border border-light" style="box-shadow: 0px 0px 20px 0px rgba(0,0,0,0.1);">
        <div class="card-body">
          <h5 class="card-title" style="text-align: center;font-size: 1.5rem;">打分介绍</h5>
          <hr>
          <p class="card-text">请您对右侧视频进行评价。若您认为视频是自然视频，不是合成伪造视频，选择左边按钮；认为视频是伪造视频，选择右侧按钮；难以判断，选择中间按钮。选择完成后，自动进入下一个视频。</p>
          <p id="current_videocount_p">您当前评估了{{ testednumber }}个视频，还有{{ testednumber|mul:-1|add:10 }}个视频需要评估。
            若有问题，请联系georgefen@qq.com</p>
        </div>
      </div>

      <span>
      </span>
    </div>
    <div class="col-sm-9">
      <div class="card border border-light" style="box-shadow: 0px 0px 20px 0px rgba(0,0,0,0.1);">
        <div class="card-body">

          <div class="container">
            <h5 class="card-title text-center" id="current_videocount" style="text-align: center;font-size: 1.5rem;">您当前评估了{{ testednumber }}个视频</h5>
            <h2 class="text-center" id="current_videocaption" style="display:none">{{video.caption}}</h2>
            <p id="current_videoID" style="display:none">{{video.videoID}}</p>
            <hr>
            <video
            id="my-video"
            class="video-js vjs-default-skin vjs-big-play-centered"
            controls
            preload="auto"
            autoplay="true"
            muted
            data-setup='{"fluid":true,"aspectRatio":"16:9"}'>
              <source src="{{video.video.url}}" id="current_video" type="video/mp4" />
              <p class="vjs-no-js">
                To view this video please enable JavaScript, and consider upgrading to a
                web browser that
                <a href="https://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
              </p>
            </video>
            <script src="https://vjs.zencdn.net/7.17.0/video.min.js"></script>
          </div>
      
          <hr>
          <div class="container" style="text-align: center;">
            <div class="btn-group" role="group">
              <button type="button" id="btn_true" class="btn btn-success">自然，不是伪造视频</button>
              <button type="button" id="btn_uncertain" class="btn btn-warning">有些不自然，可能是伪造视频</button>
              <button type="button" id="btn_fake" class="btn btn-danger">不自然，是伪造视频</button>
            </div>
          </div>


        </div>
      </div>

    </div>
  </div>
</div>

    

{% endblock %}